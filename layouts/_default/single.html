{{ define "meta" }}
<meta property="og:title" content="{{ .Title }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:description" content="{{ .Summary | plainify | truncate 300 | htmlEscape }}" />
<meta name="description" content="{{ .Summary | plainify | truncate 150 |  htmlEscape }}" />
<script src="https://unpkg.com/alpinejs" defer></script>
{{ $permalink := .Permalink }}
{{ with index .Params "og-image" }}
    {{ with $.Resources.Get . }}
    <meta property="og:image" content="{{ .Permalink }}" />
   {{ end }}
{{ end }}

{{ end }}

{{ define "main" }}

{{ partial "imports/asset" (dict "name" "syntax-highlighting.css") }}
{{ partial "imports/asset" (dict "name" "single.css") }}
{{ partial "imports/asset" (dict "name" "list.css") }}
{{ partial "imports/single-css" . }}
{{ partial "imports/single-js" . }}

{{ $content := .Content }}
{{ $footnotes := "" }}
{{ $mainContent := $content }}

{{ $footnotesRegex := `(?s)<div class="footnotes"[^>]*>.*?</div>` }}
{{ if findRE $footnotesRegex $content }}
    {{ $footnotes = index (findRE $footnotesRegex $content) 0 }}
    {{ $mainContent = replaceRE $footnotesRegex "" $content }}
{{ end }}

<main>
    <aside>
        <a href="/{{ .Section }}" class="index-link">↩︎</a>
        {{ .TableOfContents }}
    </aside>
    <article>
        <header>
            <h1>{{ .Title }}</h1>
              <time>{{ .Date.Format "January 2006" }}</time>
        </header>
            {{ $mainContent :=  $mainContent | replaceRE `::(.*?)::` `<mark>$1</mark>` }}
            {{ $mainContent | safeHTML }}
        <footer>
            {{ if $footnotes }}
                    {{ $footnotes | safeHTML }}
            {{ end }}
        </footer>
    </article>
</main>
{{ end }}
