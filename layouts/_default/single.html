{{ define "meta" }}
<meta property="og:title" content="{{ .Title }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:description" content="{{ .Summary | plainify | truncate 300 | htmlEscape }}" />
<meta name="description" content="{{ .Summary | plainify | truncate 150 |  htmlEscape }}" />
<script src="https://unpkg.com/alpinejs" defer></script>
{{ $permalink := .Permalink }}
{{ with index .Params "og-image" }}
    {{ with $.Resources.Get . }}
    <meta property="og:image" content="{{ .Permalink }}" />
   {{ end }}
{{ end }}

{{ end }}

{{ define "main" }}

{{ partial "import/styles" "syntax.scss" }}
{{ partial "import/styles" "single.scss" }}
{{ partial "import/single/css" . }}
{{ partial "import/single/js" . }}

{{ $content := .Content }}
{{ $footnotes := "" }}
{{ $mainContent := $content }}

{{ $footnotesRegex := `(?s)<div class="footnotes"[^>]*>.*?</div>` }}
{{ if findRE $footnotesRegex $content }}
    {{ $footnotes = index (findRE $footnotesRegex $content) 0 }}
    {{ $mainContent = replaceRE $footnotesRegex "" $content }}
{{ end }}

<main>
    <aside>
        <a href="/{{ .Section }}" class="index-link">↩︎</a>
    </aside>
    <article>
        <header>
            <h1>{{ .Title }}</h1>
              <time>{{ .Date.Format "January 2006" }}</time>
        </header>
        <section>
            {{ $mainContent :=  $mainContent | replaceRE `::(.*?)::` `<mark>$1</mark>` }}
            {{ $mainContent | safeHTML }}
        </section>
        <footer>
            {{ partial "feedback-buttons" }}
            {{ if $footnotes }}
                    {{ $footnotes | safeHTML }}
            {{ end }}
        </footer>
    </article>
</main>
{{ end }}
