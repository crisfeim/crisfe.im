<style>/* @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap'); */
/* CSS Primitives */
*, *::before, *::after {
box-sizing: border-box;
}

codegen-demo { display: block }
codegen-demo button {
    border: 0;
    background: none;
    cursor: pointer;
}

codegen-demo textarea {
padding: 0;
margin: 0;
width: 100%;
height: 340px;
border: 0;
padding: 0 16px;
resize: none;
background: none;
font-size: 13px;
font-weight: 400;
 -webkit-font-smoothing: antialiased;
 -moz-osx-font-smoothing: grayscale;
font-family:
    ui-monospace, SFMono-Regular, Menlo, "Andale Mono", Consolas, Monaco,
    monospace;
}

codegen-demo textarea:focus {
outline: none;
}

/* Main layout */
codegen-demo .container {
border: 1px solid #D9D9D9;
font-size: 16px;
position: relative;
border-radius: 4px;
overflow: hidden;
box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.05);
font-family:
ui-sans-serif,
-apple-system,
BlinkMacSystemFont,
"Segoe UI",
Roboto,
sans-serif;
}

codegen-demo vstack.right {
    background-color: #F9F9F9;
}

/* Utility classes*/

codegen-demo .header {
height: 48px;
padding: 0px 16px;
}

codegen-demo .border-bottom {
border-bottom: 1px solid #D9D9D9;
}

codegen-demo vstack.right.grid-background {
background-color: #f9f9f9;
background-image: radial-gradient(rgba(0, 0, 0, 0.05) 1.2px, transparent 0);
background-size: 12px 12px;
}

/* Left side (specs, run button) */
codegen-demo button#run-button {
cursor: not-allowed;
opacity: 0.5;
will-change: opacity;
transition: opacity 0.2s ease;
}

codegen-demo button#run-button.canRun {
opacity: 1;
cursor: pointer;
}

codegen-demo button#run-button.canRun:hover {
opacity: 0.5;
}

codegen-demo button #clear {
font-size: 16px;
width:32px;
border-radius: 2px;
transition: background-color 0.2s ease;
cursor: pointer;
}

codegen-demo button #clear:hover {
background-color: #E3E3E3;
}

/*  Right side (generated code, loader, runResult, etc...) */
codegen-demo #count {
font-size: 13px;
font-weight: bold;
padding: 16px;
color: gray;
transition: opacity 0.5s ease, color 0.5s ease;
}

codegen-demo #count.failure {
    color: #4A0D0D;
}

codegen-demo #count.success {
    color: #0D4A11;
}

codegen-demo #mobile-version {
display: block;
}

codegen-demo .footer {
position: absolute;
padding: 0px 12px;
bottom: 0;
left: 0;
right: 0;
}



codegen-demo .status-indicator * {
transition: opacity 0.2s ease;
}
codegen-demo .status-indicator {
    width: 20px;
    height: 20px;
}

codegen-demo #activity-indicator {
    transition: opacity 1s ease;
    opacity: 0;
}

codegen-demo vstack.right {
    transition: background-color 0.8s ease;
}

codegen-demo vstack.right.success {
    background-color: #EEFCEF;
}

codegen-demo vstack.right.failure {
    background-color: #FBEAEA;
}

/* Media queries */
@media (min-width: 480px) {
    codegen-demo#regular-version {
        display: flex;
    }

    codegen-demo vstack.left {
        border-right: 1px solid #D9D9D9;
    }
}

@media (max-width: 480px) {
    codegen-demo #regular-version {
        flex-direction: column;
    }

    codegen-demo vstack.left {
        border-bottom: 1px solid #D9D9D9;
    }

    codegen-demo textarea {
        height: 140px;
    }
}

/* Layout Primitives */
zstack { position: relative; }

zstack * {
position: absolute;
left: 0;
right: 0;
top: 0;
bottom: 0;
will-change: opacity;
}

hstack {
display: flex;
align-self: stretch;
align-items: center;
flex-direction: row;
}

vstack {
display: flex;
align-self: stretch;
flex: 1 1 auto;
flex-direction: column;
}

spacer {flex: 1;}
</style>

<div x-data="{
  provider: 'llm7',
  apiKey: null,
  showState: false
}">

    <hstack style="margin-bottom: 12px">
        <!-- <label>
          <input type="checkbox" x-model="showState" class="form-checkbox">
          <span style="font-size: 12px;">Show state</span>
        </label> -->
        <spacer></spacer>

        <select
          x-ref="selector"
          :value="provider"
          @change="
            const value = $event.target.value;
            if (value === 'gemini') {
              const key = prompt('Introduce la API key para Gemini:');
              if (key) {
                apiKey = key;
                provider = value;
              } else {
                alert('Se requiere una clave.');
                apiKey = null;
                provider = 'llm7';
                $refs.selector.value = 'llm7'; // ← FORZAMOS EL SELECT VISUAL
              }
            } else {
              apiKey = null;
              provider = value;
            }
          ">
          <option value="ollama">Ollama</option>
          <option value="llm7">LLM7</option>
          <option value="gemini">Gemini</option>
        </select>
    <option value="ollama" :selected="provider === 'ollama'">Ollama</option>
    <option value="llm7" :selected="provider === 'llm7'">LLM7</option>
    <option value="gemini" :selected="provider === 'gemini'">Gemini</option>
  </select>

    </hstack>
  <template x-if="provider === 'ollama'">
    <div x-data="CodeGenCore.ollamaViewModel(15)">
       <codegen-demo>
     <hstack id="regular-version" class="container">
         <vstack class="left">
             <hstack class="header">
                 <spacer></spacer>
                 <button id="run-button"
                 @click="run"
                 :disabled="isRunning"
                 :class="{ 'canRun': !isRunning }">
                     <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>play-button</title>
<defs>
    <path d="M17.6313437,9.40334243 L2.96465625,2.06999755 C2.758,1.96734128 2.5133125,1.97799753 2.31665625,2.0993413 C2.12,2.22134132 2,2.43534135 2,2.66665389 L2,17.3333124 C2,17.5646562 2.12,17.7786562 2.31665625,17.9006562 C2.4233125,17.9666562 2.54465625,18 2.66665625,18 C2.76865625,18 2.87065625,17.9766562 2.96465625,17.93 L17.6313125,10.5966551 C17.8573437,10.4833426 18,10.2526551 18,10 C18,9.74734248 17.8573437,9.51665494 17.6313437,9.40334243 Z" id="path-1"></path>
    <filter x="-46.9%" y="-34.4%" width="194.9%" height="193.5%" filterUnits="objectBoundingBox" id="filter-2">
    <feMorphology radius="0.5" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology>
    <feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset>
    <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
    <feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"></feComposite>
    <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.100305944 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
    </filter>
</defs>
<g id="play-button" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <rect fill="#FFFFFF" x="0" y="0" width="20" height="20"></rect>
    <g id="Trazado" fill-rule="nonzero">
    <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>
    <use stroke="#737373" stroke-width="1" fill="#E3E3E3" xlink:href="#path-1"></use>
    </g>
</g>
</svg>

                 </button>

             </hstack>
             <textarea id="specs" x-model="specification"></textarea>
         </vstack>

         <vstack
             class="right"
             :class="{
                 'grid-background': status === undefined & !isRunning,
                 'success': status === 'success',
                 'failure': status === 'failure'
               }"
         >
         <hstack class="header">
              <div id="activity-indicator" class="ispinner" x-bind:style="isRunning ? 'opacity: 1' : 'opacity: 0'">
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
 </div>

 <style>
   .ispinner {
     position: relative;
     width: 20px;
     height: 20px; }
   .ispinner .ispinner-blade {
     position: absolute;
     top: 6.5px;
     left: 8.5px;
     width: 2.5px;
     height: 6.5px;
     background-color: #8e8e93;
     border-radius: 1.25px;
     animation: iSpinnerBlade 1s linear infinite;
     will-change: opacity; }
   .ispinner .ispinner-blade:nth-child(1) {
     transform: rotate(45deg) translateY(-6.5px);
     animation-delay: -1.625s; }
   .ispinner .ispinner-blade:nth-child(2) {
     transform: rotate(90deg) translateY(-6.5px);
     animation-delay: -1.5s; }
   .ispinner .ispinner-blade:nth-child(3) {
     transform: rotate(135deg) translateY(-6.5px);
     animation-delay: -1.375s; }
   .ispinner .ispinner-blade:nth-child(4) {
     transform: rotate(180deg) translateY(-6.5px);
     animation-delay: -1.25s; }
   .ispinner .ispinner-blade:nth-child(5) {
     transform: rotate(225deg) translateY(-6.5px);
     animation-delay: -1.125s; }
   .ispinner .ispinner-blade:nth-child(6) {
     transform: rotate(270deg) translateY(-6.5px);
     animation-delay: -1s; }
   .ispinner .ispinner-blade:nth-child(7) {
     transform: rotate(315deg) translateY(-6.5px);
     animation-delay: -0.875s; }
   .ispinner .ispinner-blade:nth-child(8) {
     transform: rotate(360deg) translateY(-6.5px);
     animation-delay: -0.75s; }
   .ispinner.ispinner-large {
     width: 35px;
     height: 35px; }
   .ispinner.ispinner-large .ispinner-blade {
     top: 11.5px;
     left: 15px;
     width: 5px;
     height: 12px;
     border-radius: 2.5px; }
   .ispinner.ispinner-large .ispinner-blade:nth-child(1) {
     transform: rotate(45deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(2) {
     transform: rotate(90deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(3) {
     transform: rotate(135deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(4) {
     transform: rotate(180deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(5) {
     transform: rotate(225deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(6) {
     transform: rotate(270deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(7) {
     transform: rotate(315deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(8) {
     transform: rotate(360deg) translateY(-11.5px); }

   @keyframes iSpinnerBlade {
     0% {
       opacity: 0.85; }
     50% {
       opacity: 0.25; }
     100% {
       opacity: 0.25; } }
 </style>

             <spacer></spacer>
             <zstack class="status-indicator" >
    <div id="success-indicator" x-bind:style="status === 'success' ? 'opacity: 1' : 'opacity: 0'">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>successs-indicator</title>
<g id="success-indicator" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <circle id="Óvalo" stroke="#81B284" fill="#CEF6D1" cx="10" cy="10" r="8"></circle>
    <line x1="6" y1="10.4615385" x2="8.46153846" y2="12.9230769" id="Línea-3" stroke="#0D4A11" stroke-width="1.5" stroke-linecap="square"></line>
    <line x1="8.46153846" y1="12.9230769" x2="13.3846154" y2="8" id="Línea-4" stroke="#0D4A11" stroke-width="1.5" stroke-linecap="square"></line>
</g>
</svg>

    </div>
    <div id="failure-indicator" x-bind:style="status === 'failure' ? 'opacity: 1' : 'opacity: 0'">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>failure-indicator</title>
<g id="failure-indicator stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Grupo" transform="translate(2, 2)" fill="#F6CECE" stroke="#B26868">
<circle id="Óvalo" cx="8" cy="8" r="8"></circle>
</g>
<g id="Grupo-2" transform="translate(7, 7)" stroke="#4A0D0D" stroke-linecap="square" stroke-width="1.5">
<line x1="0.719389322" y1="0.375" x2="5.96938932" y2="5.625" id="Línea-3"></line>
<line x1="5.625" y1="0.375" x2="0.375" y2="5.625" id="Línea-6"></line>
</g>
</g>
</svg>

    </div>
</zstack>

         </hstack>

         <textarea id="generated-code" readonly x-model="generatedCode"></textarea>
         <hstack id="count"
             :class="{ 'success': status === 'success','failure': status === 'failure' }"
             x-bind:style="status !== undefined ? 'opacity: 1' : 'opacity: 0'">
             <spacer></spacer>
             <span id="iteration-count" x-text="`${currentIteration} of ${maxIterations}`"></span>
         </hstack>
         </vstack>
     </hstack>

     <pre x-show="showState" x-transition x-text="JSON.stringify($data, null, 2)" style="margin-top: 24px"></pre>
 </codegen-demo>

    </div>
  </template>

  <template x-if="provider === 'llm7'">
    <div x-data="CodeGenCore.llm7ViewModel(15)">
       <codegen-demo>
     <hstack id="regular-version" class="container">
         <vstack class="left">
             <hstack class="header">
                 <spacer></spacer>
                 <button id="run-button"
                 @click="run"
                 :disabled="isRunning"
                 :class="{ 'canRun': !isRunning }">
                     <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>play-button</title>
<defs>
    <path d="M17.6313437,9.40334243 L2.96465625,2.06999755 C2.758,1.96734128 2.5133125,1.97799753 2.31665625,2.0993413 C2.12,2.22134132 2,2.43534135 2,2.66665389 L2,17.3333124 C2,17.5646562 2.12,17.7786562 2.31665625,17.9006562 C2.4233125,17.9666562 2.54465625,18 2.66665625,18 C2.76865625,18 2.87065625,17.9766562 2.96465625,17.93 L17.6313125,10.5966551 C17.8573437,10.4833426 18,10.2526551 18,10 C18,9.74734248 17.8573437,9.51665494 17.6313437,9.40334243 Z" id="path-1"></path>
    <filter x="-46.9%" y="-34.4%" width="194.9%" height="193.5%" filterUnits="objectBoundingBox" id="filter-2">
    <feMorphology radius="0.5" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology>
    <feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset>
    <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
    <feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"></feComposite>
    <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.100305944 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
    </filter>
</defs>
<g id="play-button" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <rect fill="#FFFFFF" x="0" y="0" width="20" height="20"></rect>
    <g id="Trazado" fill-rule="nonzero">
    <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>
    <use stroke="#737373" stroke-width="1" fill="#E3E3E3" xlink:href="#path-1"></use>
    </g>
</g>
</svg>

                 </button>

             </hstack>
             <textarea id="specs" x-model="specification"></textarea>
         </vstack>

         <vstack
             class="right"
             :class="{
                 'grid-background': status === undefined & !isRunning,
                 'success': status === 'success',
                 'failure': status === 'failure'
               }"
         >
         <hstack class="header">
              <div id="activity-indicator" class="ispinner" x-bind:style="isRunning ? 'opacity: 1' : 'opacity: 0'">
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
 </div>

 <style>
   .ispinner {
     position: relative;
     width: 20px;
     height: 20px; }
   .ispinner .ispinner-blade {
     position: absolute;
     top: 6.5px;
     left: 8.5px;
     width: 2.5px;
     height: 6.5px;
     background-color: #8e8e93;
     border-radius: 1.25px;
     animation: iSpinnerBlade 1s linear infinite;
     will-change: opacity; }
   .ispinner .ispinner-blade:nth-child(1) {
     transform: rotate(45deg) translateY(-6.5px);
     animation-delay: -1.625s; }
   .ispinner .ispinner-blade:nth-child(2) {
     transform: rotate(90deg) translateY(-6.5px);
     animation-delay: -1.5s; }
   .ispinner .ispinner-blade:nth-child(3) {
     transform: rotate(135deg) translateY(-6.5px);
     animation-delay: -1.375s; }
   .ispinner .ispinner-blade:nth-child(4) {
     transform: rotate(180deg) translateY(-6.5px);
     animation-delay: -1.25s; }
   .ispinner .ispinner-blade:nth-child(5) {
     transform: rotate(225deg) translateY(-6.5px);
     animation-delay: -1.125s; }
   .ispinner .ispinner-blade:nth-child(6) {
     transform: rotate(270deg) translateY(-6.5px);
     animation-delay: -1s; }
   .ispinner .ispinner-blade:nth-child(7) {
     transform: rotate(315deg) translateY(-6.5px);
     animation-delay: -0.875s; }
   .ispinner .ispinner-blade:nth-child(8) {
     transform: rotate(360deg) translateY(-6.5px);
     animation-delay: -0.75s; }
   .ispinner.ispinner-large {
     width: 35px;
     height: 35px; }
   .ispinner.ispinner-large .ispinner-blade {
     top: 11.5px;
     left: 15px;
     width: 5px;
     height: 12px;
     border-radius: 2.5px; }
   .ispinner.ispinner-large .ispinner-blade:nth-child(1) {
     transform: rotate(45deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(2) {
     transform: rotate(90deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(3) {
     transform: rotate(135deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(4) {
     transform: rotate(180deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(5) {
     transform: rotate(225deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(6) {
     transform: rotate(270deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(7) {
     transform: rotate(315deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(8) {
     transform: rotate(360deg) translateY(-11.5px); }

   @keyframes iSpinnerBlade {
     0% {
       opacity: 0.85; }
     50% {
       opacity: 0.25; }
     100% {
       opacity: 0.25; } }
 </style>

             <spacer></spacer>
             <zstack class="status-indicator" >
    <div id="success-indicator" x-bind:style="status === 'success' ? 'opacity: 1' : 'opacity: 0'">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>successs-indicator</title>
<g id="success-indicator" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <circle id="Óvalo" stroke="#81B284" fill="#CEF6D1" cx="10" cy="10" r="8"></circle>
    <line x1="6" y1="10.4615385" x2="8.46153846" y2="12.9230769" id="Línea-3" stroke="#0D4A11" stroke-width="1.5" stroke-linecap="square"></line>
    <line x1="8.46153846" y1="12.9230769" x2="13.3846154" y2="8" id="Línea-4" stroke="#0D4A11" stroke-width="1.5" stroke-linecap="square"></line>
</g>
</svg>

    </div>
    <div id="failure-indicator" x-bind:style="status === 'failure' ? 'opacity: 1' : 'opacity: 0'">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>failure-indicator</title>
<g id="failure-indicator stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Grupo" transform="translate(2, 2)" fill="#F6CECE" stroke="#B26868">
<circle id="Óvalo" cx="8" cy="8" r="8"></circle>
</g>
<g id="Grupo-2" transform="translate(7, 7)" stroke="#4A0D0D" stroke-linecap="square" stroke-width="1.5">
<line x1="0.719389322" y1="0.375" x2="5.96938932" y2="5.625" id="Línea-3"></line>
<line x1="5.625" y1="0.375" x2="0.375" y2="5.625" id="Línea-6"></line>
</g>
</g>
</svg>

    </div>
</zstack>

         </hstack>

         <textarea id="generated-code" readonly x-model="generatedCode"></textarea>
         <hstack id="count"
             :class="{ 'success': status === 'success','failure': status === 'failure' }"
             x-bind:style="status !== undefined ? 'opacity: 1' : 'opacity: 0'">
             <spacer></spacer>
             <span id="iteration-count" x-text="`${currentIteration} of ${maxIterations}`"></span>
         </hstack>
         </vstack>
     </hstack>

     <pre x-show="showState" x-transition x-text="JSON.stringify($data, null, 2)" style="margin-top: 24px"></pre>
 </codegen-demo>

    </div>
  </template>

  <template x-if="provider === 'gemini' && apiKey">
    <div x-data="CodeGenCore.geminiViewModel(apiKey, 15)">
       <codegen-demo>
     <hstack id="regular-version" class="container">
         <vstack class="left">
             <hstack class="header">
                 <spacer></spacer>
                 <button id="run-button"
                 @click="run"
                 :disabled="isRunning"
                 :class="{ 'canRun': !isRunning }">
                     <svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>play-button</title>
<defs>
    <path d="M17.6313437,9.40334243 L2.96465625,2.06999755 C2.758,1.96734128 2.5133125,1.97799753 2.31665625,2.0993413 C2.12,2.22134132 2,2.43534135 2,2.66665389 L2,17.3333124 C2,17.5646562 2.12,17.7786562 2.31665625,17.9006562 C2.4233125,17.9666562 2.54465625,18 2.66665625,18 C2.76865625,18 2.87065625,17.9766562 2.96465625,17.93 L17.6313125,10.5966551 C17.8573437,10.4833426 18,10.2526551 18,10 C18,9.74734248 17.8573437,9.51665494 17.6313437,9.40334243 Z" id="path-1"></path>
    <filter x="-46.9%" y="-34.4%" width="194.9%" height="193.5%" filterUnits="objectBoundingBox" id="filter-2">
    <feMorphology radius="0.5" operator="dilate" in="SourceAlpha" result="shadowSpreadOuter1"></feMorphology>
    <feOffset dx="0" dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"></feOffset>
    <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>
    <feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"></feComposite>
    <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.100305944 0" type="matrix" in="shadowBlurOuter1"></feColorMatrix>
    </filter>
</defs>
<g id="play-button" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <rect fill="#FFFFFF" x="0" y="0" width="20" height="20"></rect>
    <g id="Trazado" fill-rule="nonzero">
    <use fill="black" fill-opacity="1" filter="url(#filter-2)" xlink:href="#path-1"></use>
    <use stroke="#737373" stroke-width="1" fill="#E3E3E3" xlink:href="#path-1"></use>
    </g>
</g>
</svg>

                 </button>

             </hstack>
             <textarea id="specs" x-model="specification"></textarea>
         </vstack>

         <vstack
             class="right"
             :class="{
                 'grid-background': status === undefined & !isRunning,
                 'success': status === 'success',
                 'failure': status === 'failure'
               }"
         >
         <hstack class="header">
              <div id="activity-indicator" class="ispinner" x-bind:style="isRunning ? 'opacity: 1' : 'opacity: 0'">
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
   <div class="ispinner-blade"></div>
 </div>

 <style>
   .ispinner {
     position: relative;
     width: 20px;
     height: 20px; }
   .ispinner .ispinner-blade {
     position: absolute;
     top: 6.5px;
     left: 8.5px;
     width: 2.5px;
     height: 6.5px;
     background-color: #8e8e93;
     border-radius: 1.25px;
     animation: iSpinnerBlade 1s linear infinite;
     will-change: opacity; }
   .ispinner .ispinner-blade:nth-child(1) {
     transform: rotate(45deg) translateY(-6.5px);
     animation-delay: -1.625s; }
   .ispinner .ispinner-blade:nth-child(2) {
     transform: rotate(90deg) translateY(-6.5px);
     animation-delay: -1.5s; }
   .ispinner .ispinner-blade:nth-child(3) {
     transform: rotate(135deg) translateY(-6.5px);
     animation-delay: -1.375s; }
   .ispinner .ispinner-blade:nth-child(4) {
     transform: rotate(180deg) translateY(-6.5px);
     animation-delay: -1.25s; }
   .ispinner .ispinner-blade:nth-child(5) {
     transform: rotate(225deg) translateY(-6.5px);
     animation-delay: -1.125s; }
   .ispinner .ispinner-blade:nth-child(6) {
     transform: rotate(270deg) translateY(-6.5px);
     animation-delay: -1s; }
   .ispinner .ispinner-blade:nth-child(7) {
     transform: rotate(315deg) translateY(-6.5px);
     animation-delay: -0.875s; }
   .ispinner .ispinner-blade:nth-child(8) {
     transform: rotate(360deg) translateY(-6.5px);
     animation-delay: -0.75s; }
   .ispinner.ispinner-large {
     width: 35px;
     height: 35px; }
   .ispinner.ispinner-large .ispinner-blade {
     top: 11.5px;
     left: 15px;
     width: 5px;
     height: 12px;
     border-radius: 2.5px; }
   .ispinner.ispinner-large .ispinner-blade:nth-child(1) {
     transform: rotate(45deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(2) {
     transform: rotate(90deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(3) {
     transform: rotate(135deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(4) {
     transform: rotate(180deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(5) {
     transform: rotate(225deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(6) {
     transform: rotate(270deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(7) {
     transform: rotate(315deg) translateY(-11.5px); }
   .ispinner.ispinner-large .ispinner-blade:nth-child(8) {
     transform: rotate(360deg) translateY(-11.5px); }

   @keyframes iSpinnerBlade {
     0% {
       opacity: 0.85; }
     50% {
       opacity: 0.25; }
     100% {
       opacity: 0.25; } }
 </style>

             <spacer></spacer>
             <zstack class="status-indicator" >
    <div id="success-indicator" x-bind:style="status === 'success' ? 'opacity: 1' : 'opacity: 0'">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>successs-indicator</title>
<g id="success-indicator" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <circle id="Óvalo" stroke="#81B284" fill="#CEF6D1" cx="10" cy="10" r="8"></circle>
    <line x1="6" y1="10.4615385" x2="8.46153846" y2="12.9230769" id="Línea-3" stroke="#0D4A11" stroke-width="1.5" stroke-linecap="square"></line>
    <line x1="8.46153846" y1="12.9230769" x2="13.3846154" y2="8" id="Línea-4" stroke="#0D4A11" stroke-width="1.5" stroke-linecap="square"></line>
</g>
</svg>

    </div>
    <div id="failure-indicator" x-bind:style="status === 'failure' ? 'opacity: 1' : 'opacity: 0'">
        <?xml version="1.0" encoding="UTF-8"?>
<svg width="20px" height="20px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>failure-indicator</title>
<g id="failure-indicator stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Grupo" transform="translate(2, 2)" fill="#F6CECE" stroke="#B26868">
<circle id="Óvalo" cx="8" cy="8" r="8"></circle>
</g>
<g id="Grupo-2" transform="translate(7, 7)" stroke="#4A0D0D" stroke-linecap="square" stroke-width="1.5">
<line x1="0.719389322" y1="0.375" x2="5.96938932" y2="5.625" id="Línea-3"></line>
<line x1="5.625" y1="0.375" x2="0.375" y2="5.625" id="Línea-6"></line>
</g>
</g>
</svg>

    </div>
</zstack>

         </hstack>

         <textarea id="generated-code" readonly x-model="generatedCode"></textarea>
         <hstack id="count"
             :class="{ 'success': status === 'success','failure': status === 'failure' }"
             x-bind:style="status !== undefined ? 'opacity: 1' : 'opacity: 0'">
             <spacer></spacer>
             <span id="iteration-count" x-text="`${currentIteration} of ${maxIterations}`"></span>
         </hstack>
         </vstack>
     </hstack>

     <pre x-show="showState" x-transition x-text="JSON.stringify($data, null, 2)" style="margin-top: 24px"></pre>
 </codegen-demo>

    </div>
  </template>
</div>

<script>
var CodeGenCore = (() => {
  var __getOwnPropNames = Object.getOwnPropertyNames;
  var __esm = (fn, res) => function __init() {
    return fn && (res = (0, fn[__getOwnPropNames(fn)[0]])(fn = 0)), res;
  };
  var __commonJS = (cb, mod) => function __require() {
    return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
  };

  // core/coordinator.ts
  var Coordinator;
  var init_coordinator = __esm({
    "core/coordinator.ts"() {
      Coordinator = class {
        constructor(client, runner, iterator) {
          this.client = client;
          this.runner = runner;
          this.iterator = iterator;
          this.client = client;
          this.runner = runner;
          this.iterator = iterator;
        }
        async generate(systemPrompt, specs, maxIterations) {
          let previousStderr;
          return await this.iterator.iterate(
            maxIterations,
            async () => await this.generateCodeFromSpecsWithPreviousFeedback(systemPrompt, specs, previousStderr),
            (result) => {
              previousStderr = result.stdErr;
              return result.isValid;
            }
          );
        }
        async generateCodeFromSpecsWithPreviousFeedback(systemPrompt, specs, previousStderr) {
          const systemPromptMessage = { role: "system", content: systemPrompt };
          const userMessage = { role: "user", content: specs };
          let messages = [systemPromptMessage, userMessage];
          if (previousStderr) {
            messages.push({ role: "assistant", content: previousStderr });
          }
          const generated = await this.client.send(messages);
          const processed = generated.replace(/^```(?:\w+)?\s*/m, "").replace(/```$/, "");
          const concatenated = `${generated}
${specs}`;
          const runResult = this.runner.run(concatenated);
          return { generatedCode: generated, stdErr: runResult.stdErr, isValid: runResult.isValid };
        }
        // @TODO: remove this method
        async generateCodeFromSpecs(systemPrompt, specs) {
          const systemPromptMessage = { role: "system", content: systemPrompt };
          const userMessage = { role: "user", content: specs };
          const generated = await this.client.send([systemPromptMessage, userMessage]);
          const concatenated = `${specs}
${generated}`;
          const runResult = this.runner.run(concatenated);
          return { generatedCode: generated, isValid: runResult.isValid };
        }
      };
    }
  });

  // core/iterator.ts
  var Iterator;
  var init_iterator = __esm({
    "core/iterator.ts"() {
      Iterator = class {
        async iterate(nTimes, action, until) {
          let currentIteration = 0;
          let result;
          while (currentIteration < nTimes) {
            result = await action();
            if (until(result)) {
              return result;
            }
            currentIteration++;
          }
          return result;
        }
      };
    }
  });

  // core/viewModel.ts
  function makeReactiveViewModel(client, runner, maxIterations) {
    const baseIterator = new Iterator();
    const observedIterator = new ObservableIterator(baseIterator);
    const coordinator = new Coordinator(client, runner, observedIterator);
    const initialState = {
      isRunning: false,
      generatedCodes: [],
      currentIteration: 0,
      statuses: [],
      specification: initSpecs(),
      maxIterations,
      systemPrompt: defaultSystemPrompt()
    };
    const vm = {
      ...initialState,
      run: async function() {
        observedIterator.onIterationChange = (i) => this.currentIteration = i;
        observedIterator.onStatusChange = (s) => this.statuses.push(s);
        observedIterator.onGeneratedCode = (c) => this.generatedCodes.push(c);
        this.generatedCodes.splice(0);
        this.statuses.splice(0);
        this.currentIteration = 0;
        this.isRunning = true;
        try {
          await coordinator.generate(this.systemPrompt, this.specification, this.maxIterations);
        } catch {
          this.statuses.push("failure");
        }
        this.isRunning = false;
      },
      get status() {
        return this.statuses[this.statuses.length - 1];
      },
      get generatedCode() {
        return this.generatedCodes[this.generatedCodes.length - 1];
      }
    };
    return vm;
  }
  var ObservableIterator, defaultSystemPrompt, initSpecs;
  var init_viewModel = __esm({
    "core/viewModel.ts"() {
      init_coordinator();
      init_iterator();
      ObservableIterator = class extends Iterator {
        iterator;
        onIterationChange;
        onStatusChange;
        onGeneratedCode;
        constructor(iterator) {
          super();
          this.iterator = iterator;
        }
        async iterate(nTimes, action, until) {
          var iterationCount = 0;
          const newAction = async () => {
            iterationCount++;
            const result = await action();
            const mapped = result;
            this.onStatusChange?.(mapped.isValid ? "success" : "failure");
            this.onIterationChange?.(iterationCount);
            this.onGeneratedCode?.(mapped.generatedCode);
            return result;
          };
          return await super.iterate(nTimes, newAction, until);
        }
      };
      defaultSystemPrompt = () => `
  Imagine that you are a programmer and the user's responses are feedback from compiling your code in your development environment. Your responses are the code you write, and the user's responses represent the feedback, including any errors.

  Implement the SUT's code in JavaScript based on the provided specs (unit tests).

  Follow these strict guidelines:

  1. Provide ONLY runnable JavaScript code. No explanations, comments, or formatting (no code blocks, markdown, symbols, or text).
  2. DO NOT include unit tests or any test-related code.
  3. DO NOT redefine any global functions or helpers (such as assertEqual) that may already be provided by the environment.
  4. Only implement the code required to make the current test pass.
  5. Avoid including unnecessary wrappers, main functions, or scaffolding \u2014 only the essential implementation.

  If your code fails to compile, the user will provide the error output for you to make adjustments.
  `;
      initSpecs = () => `
function testAdder() {
  const sut = new Adder(1, 2);
  assertEqual(sut.result, 3);
}

testAdder();`;
    }
  });

  // core/ollamaclient.ts
  var OllamaClient;
  var init_ollamaclient = __esm({
    "core/ollamaclient.ts"() {
      OllamaClient = class {
        model = "llama3.2";
        url = "http://localhost:11434/api/chat";
        async send(messages) {
          const body = {
            model: this.model,
            messages,
            stream: false
          };
          const response = await fetch(this.url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
          });
          if (!response.ok) {
            throw new Error(`OllamaClient: HTTP error ${response.status}`);
          }
          const data = await response.json();
          if (!data?.message?.content) {
            throw new Error("OllamaClient: Invalid response shape");
          }
          return data.message.content;
        }
      };
    }
  });

  // core/geminiclient.ts
  var GeminiClient;
  var init_geminiclient = __esm({
    "core/geminiclient.ts"() {
      GeminiClient = class {
        constructor(apiKey) {
          this.apiKey = apiKey;
        }
        async send(messages) {
          const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${this.apiKey}`;
          const mapped = messages.map(({ role, content }) => ({
            role: role === "system" ? "model" : role,
            parts: [{ text: content }]
          }));
          const res = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: mapped,
              generationConfig: {
                stopSequences: []
              }
            })
          });
          if (!res.ok) {
            const err = await res.json();
            throw new Error(`GeminiClient: API error: ${err.error.message}`);
          }
          const data = await res.json();
          return data.candidates?.[0]?.content?.parts?.[0]?.text ?? "";
        }
      };
    }
  });

  // core/evalrunner.ts
  var EvalRunner;
  var init_evalrunner = __esm({
    "core/evalrunner.ts"() {
      EvalRunner = class {
        run(code) {
          const assertHelpers = `
       function assertEqual(actual, expected) {
         if (actual !== expected) {
           throw new Error(\`Assertion failed: expected \${expected}, but got \${actual}\`);
         }
       }
     `;
          try {
            eval(assertHelpers + "\n" + code);
            return { isValid: true };
          } catch (error) {
            return {
              isValid: false,
              stdErr: String(error)
            };
          }
        }
      };
    }
  });

  // core/llm7client.ts
  var LLM7Client;
  var init_llm7client = __esm({
    "core/llm7client.ts"() {
      LLM7Client = class {
        model = "gpt-3.5-turbo";
        url = "https://api.llm7.io/v1/chat/completions";
        async send(messages) {
          const body = {
            model: this.model,
            messages,
            stream: false
          };
          const response = await fetch(this.url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
          });
          if (!response.ok) {
            throw new Error(`LLM7Client: HTTP error ${response.status}`);
          }
          const data = await response.json();
          if (!data?.choices?.[0]?.message?.content) {
            throw new Error("LLM7Client: Invalid response shape");
          }
          return data.choices[0].message.content;
        }
      };
    }
  });

  // core/_entrypoint.ts
  var ollamaViewModel, geminiViewModel, llm7ViewModel, fakeClientViewModel;
  var init_entrypoint = __esm({
    "core/_entrypoint.ts"() {
      init_viewModel();
      init_ollamaclient();
      init_geminiclient();
      init_evalrunner();
      init_llm7client();
      ollamaViewModel = (maxIterations) => {
        const client = new OllamaClient();
        const runner = new EvalRunner();
        return makeReactiveViewModel(client, runner, maxIterations);
      };
      geminiViewModel = (apiKey, maxIterations) => {
        const client = new GeminiClient(apiKey);
        const runner = new EvalRunner();
        return makeReactiveViewModel(client, runner, maxIterations);
      };
      llm7ViewModel = (maxIterations) => {
        const client = new LLM7Client();
        const runner = new EvalRunner();
        return makeReactiveViewModel(client, runner, maxIterations);
      };
      fakeClientViewModel = () => {
        class FakeClient {
          base = [1, 2, 3];
          ids = [...this.base];
          async send() {
            if (this.ids.length === 0) {
              this.ids = [...this.base];
            }
            await new Promise((resolve) => setTimeout(resolve, 1e3));
            return `Generated code ${this.ids.shift()}`;
          }
        }
        class FakeRunner {
          base = [false, false, true];
          results = [...this.base];
          run(code2) {
            if (this.results.length === 0) {
              this.results = [...this.base];
            }
            return { isValid: this.results.shift() };
          }
        }
        const client = new FakeClient();
        const runner = new FakeRunner();
        return makeReactiveViewModel(client, runner, 3);
      };
    }
  });

  // core/entrypoint.ts
  var require_entrypoint = __commonJS({
    "core/entrypoint.ts"(exports) {
      init_entrypoint();
      exports.ollamaViewModel = ollamaViewModel;
      exports.geminiViewModel = geminiViewModel;
      exports.fakeClientViewModel = fakeClientViewModel;
      exports.llm7ViewModel = llm7ViewModel;
    }
  });
  return require_entrypoint();
})();

</script>
