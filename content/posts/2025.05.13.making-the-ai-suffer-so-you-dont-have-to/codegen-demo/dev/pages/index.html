<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<style>@import(styles.css)</style>
<div id="demo-app" x-data="makeState()">
<hstack id="regular-version" class="container">
    <vstack class="left">
        <hstack class="header">
            <spacer></spacer>
            @import(run-button.html)
        </hstack>
        <textarea id="specs" class="jet" x-model="specification"></textarea>
    </vstack>

    <vstack class="right grid-background">
    <hstack class="header">
        @import(activity-indicator.html)
        <spacer></spacer>
        @import(status-indicator.html)
    </hstack>

    <textarea id="generated-code" class="jet" readonly x-model="generatedCode"></textarea>

    <hstack id="count">
        <spacer></spacer>
        <span id="iteration-count" x-show="status !== null" x-text="`${currentIteration} of 5`"></span>
    </hstack>
    </vstack>

</hstack>
</div>

<script>
const makeState = () => ({
  isRunning: false,
  specification: initSpecs(),
  generatedCode: '',
  currentIteration: 0,
  status: null,

  run() {
    this.isRunning = true;
    this.generatedCode = '';
    this.currentIteration = 0;
    this.status = null;
      let count = 0;
    const interval = setInterval(() => {
        count++;
        this.generatedCode = `Generated ${count}`;
        this.status = 'failure';
        this.currentIteration = count;

        if (count >= 5) {
        clearInterval(interval);
        this.isRunning = false;
        this.status = 'success';
        }
    }, 600);
  }
});

const initSpecs = () => `
function testAdder() {
  const sut = new Adder(1, 2);
  assert(sut.result === 3);
}

testAdder();`;
</script>
